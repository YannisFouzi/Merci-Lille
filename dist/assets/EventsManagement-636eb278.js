import{r as d,e as w,j as e,f as le,R as oe,g as F}from"./index-c82a535c.js";import{u as ie,a as ce}from"./useSelection-4bea00c8.js";const de=t=>[...t].sort((a,s)=>{if(a.order!==void 0&&s.order!==void 0&&a.order!==0&&s.order!==0)return s.order-a.order;const r=new Date(a.date).getTime();return new Date(s.date).getTime()-r}),ue=()=>{const[t,a]=d.useState([]),[s,r]=d.useState(!1),[n,m]=d.useState(""),i=d.useCallback(async()=>{try{r(!0);const u=await w.getAllEvents(!0);a(de(u)),m("")}catch{m("Erreur lors du chargement des Ã©vÃ©nements")}finally{r(!1)}},[]);d.useEffect(()=>{i()},[i]);const h=d.useCallback(async u=>{await w.deleteEvent(u),await i()},[i]),b=d.useCallback(async u=>{await Promise.all(u.map(j=>w.deleteEvent(j))),await i()},[i]),o=d.useCallback(async u=>{await w.updateEventOrder(u),await i()},[i]),x=d.useCallback(async u=>{await w.hideMultipleEvents(u),await i()},[i]),v=d.useCallback(async u=>{await w.unhideMultipleEvents(u),await i()},[i]),y=d.useCallback(async(u,j)=>{j?await w.unhideEvent(u):await w.hideEvent(u),await i()},[i]),N=d.useCallback(async()=>{await w.renumberAllEvents(),await i()},[i]);return{events:t,setEvents:a,loading:s,error:n,setError:m,refetch:i,deleteEvent:h,deleteMany:b,updateOrder:o,hideMany:x,unhideMany:v,hideOne:y,renumberAll:N}},ge=(t=4e3)=>{const[a,s]=d.useState(null),r=d.useCallback(()=>s(null),[]),n=d.useCallback((h,b)=>{s({type:h,message:b})},[]),m=d.useCallback(h=>n("error",h),[n]),i=d.useCallback(h=>n("success",h),[n]);return d.useEffect(()=>{if(!a)return;const h=setTimeout(()=>s(null),t);return()=>clearTimeout(h)},[a,t]),{toast:a,showError:m,showSuccess:i,clearToast:r}},me=({event:t,index:a,isSelectionMode:s,isSelected:r,draggedEventId:n,dragOverIndex:m,onToggleSelect:i,onDragStart:h,onDragOver:b,onDragLeave:o,onDrop:x,onEdit:v,onToggleHide:y,onDelete:N})=>{var D,A;const u=new Date,j=new Date(t.date),[l,g]=t.time.split(":");j.setHours(parseInt(l,10),parseInt(g,10));const E=j<=u;return e.jsxs("div",{draggable:!s,onDragStart:p=>!s&&h(p,t._id),onDragOver:p=>!s&&b(p,a),onDragLeave:s?void 0:o,onDrop:p=>!s&&x(p,a),onClick:()=>s&&i(t._id),className:`relative bg-gray-800 rounded-lg overflow-hidden transition-all duration-200 ${s?"cursor-pointer":"cursor-move"} ${n===t._id?"opacity-50 scale-95":""} ${m===a?"ring-2 ring-blue-400 scale-105":""} ${s&&r?"ring-4 ring-red-500":""} ${t.isHidden?"opacity-50":""}`,children:[e.jsxs("div",{className:"absolute top-2 left-2 bg-black bg-opacity-75 text-white text-sm font-bold px-3 py-1 rounded z-10",children:["#",(D=t.eventNumber)!=null&&D.startsWith("HIDDEN_")||(A=t.eventNumber)!=null&&A.startsWith("TEMP_")?"---":t.eventNumber||"---"]}),s&&e.jsx("div",{className:"absolute top-2 left-16 z-10",children:e.jsx("input",{type:"checkbox",checked:r,onChange:p=>{p.stopPropagation(),i(t._id)},className:"w-6 h-6 cursor-pointer"})}),e.jsxs("div",{className:"absolute top-2 right-2 z-10 flex gap-2",children:[t.isHidden&&e.jsx("span",{className:"bg-orange-600 text-white text-xs px-2 py-1 rounded font-bold",children:"MasquÃ©"}),t.isFeatured&&e.jsx("span",{className:"bg-yellow-500 text-black text-xs px-2 py-1 rounded font-bold",children:"Phare"}),E?e.jsx("span",{className:"bg-gray-600 text-gray-300 text-xs px-2 py-1 rounded",children:"PassÃ©"}):e.jsx("span",{className:"bg-green-600 text-white text-xs px-2 py-1 rounded",children:"Ã€ venir"})]}),e.jsx("div",{className:"h-48 overflow-hidden",children:e.jsx("img",{src:t.imageSrc,alt:t.title,className:"w-full h-full object-cover pointer-events-none"})}),e.jsxs("div",{className:"p-4 space-y-2",children:[e.jsx("h3",{className:"text-white font-bold text-lg truncate",children:t.title}),e.jsxs("div",{className:"text-gray-400 text-sm space-y-1",children:[e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx("span",{role:"img","aria-label":"date",children:"ðŸ“…"}),e.jsx("span",{children:le(t.date)})]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx("span",{role:"img","aria-label":"location",children:"ðŸ“"}),e.jsx("span",{children:t.city})]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx("span",{role:"img","aria-label":"genres",children:"ðŸŽµ"}),e.jsx("span",{className:"truncate",children:t.genres&&t.genres.length>0?t.genres.join(", "):"Aucun genre"})]})]}),!s&&e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{onClick:p=>{p.stopPropagation(),v(t)},className:"flex-1 px-3 py-2 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 transition-colors",children:"Modifier"}),e.jsx("button",{onClick:p=>{p.stopPropagation(),y(t._id,t.isHidden||!1)},className:`flex-1 px-3 py-2 text-white text-sm rounded transition-colors ${t.isHidden?"bg-green-600 hover:bg-green-700":"bg-orange-600 hover:bg-orange-700"}`,children:t.isHidden?"Afficher":"Masquer"}),e.jsx("button",{onClick:p=>{p.stopPropagation(),N(t._id)},className:"flex-1 px-3 py-2 bg-red-600 text-white text-sm rounded hover:bg-red-700 transition-colors",children:"Supprimer"})]})]})]},t._id)},he=({event:t,onSubmit:a})=>{const s=l=>new Date(l).toISOString().split("T")[0],[r,n]=d.useState(t?{...t,date:s(t.date),genres:Array.isArray(t.genres)?t.genres:typeof t.genres=="string"?JSON.parse(t.genres):[]}:{title:"",eventNumber:"",city:"",date:"",time:"",genres:[],ticketLink:"",imageSrc:"",isFeatured:!1}),[m,i]=d.useState(null),[h,b]=d.useState(""),[o,x]=d.useState(""),v=l=>{l.preventDefault(),o.trim()&&!r.genres.includes(o.trim())&&(n({...r,genres:[...r.genres,o.trim()]}),x(""))},y=l=>{n({...r,genres:r.genres.filter(g=>g!==l)})},N=async l=>{l.preventDefault();try{const g=new FormData,{eventNumber:E,...D}=r,A={...D};if(!r.title||!r.city||!r.date||!r.time||!r.ticketLink)throw new Error("Veuillez remplir tous les champs requis");if(!m&&!(t!=null&&t.imageSrc))throw new Error("Une image est requise");if(Object.entries(A).forEach(([p,k])=>{k!=null&&(p==="genres"?(Array.isArray(k)?k:[]).forEach(($,I)=>{g.append(`genres[${I}]`,$)}):g.append(p,k.toString()))}),m){if(m.size>5*1024*1024)throw new Error("L'image est trop volumineuse (max 5MB)");g.append("image",m)}t!=null&&t._id?await w.updateEvent(t._id,g):await w.createEvent(g),a()}catch(g){throw g}},u=l=>{const g=l.split("/");return g[g.length-1]};oe.useEffect(()=>{t!=null&&t.imageSrc&&b(u(t.imageSrc))},[t]);const j=l=>{var E;const g=(E=l.target.files)==null?void 0:E[0];g&&(i(g),b(g.name))};return e.jsxs("form",{onSubmit:N,className:"space-y-6 bg-gray-900 p-4 rounded-lg sm:p-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-white block text-lg font-bold border-b border-gray-600 pb-1 mb-2",children:"Titre de l'Ã©vÃ©nement"}),e.jsx("input",{type:"text",value:r.title,onChange:l=>n({...r,title:l.target.value}),placeholder:"Titre de l'Ã©vÃ©nement",className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded text-white",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-white block text-lg font-bold border-b border-gray-600 pb-1 mb-2",children:"Ville"}),e.jsx("input",{type:"text",value:r.city,onChange:l=>n({...r,city:l.target.value}),placeholder:"Ville",className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded text-white",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-white block text-lg font-bold border-b border-gray-600 pb-1 mb-2",children:"Date"}),e.jsx("input",{type:"date",value:r.date,onChange:l=>n({...r,date:l.target.value}),className:"px-3 py-2 bg-gray-800 border border-gray-700 rounded text-white w-full",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-white block text-lg font-bold border-b border-gray-600 pb-1 mb-2",children:"Heure"}),e.jsx("input",{type:"time",value:r.time,onChange:l=>n({...r,time:l.target.value}),className:"px-3 py-2 bg-gray-800 border border-gray-700 rounded text-white w-full",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-white block text-lg font-bold border-b border-gray-600 pb-1 mb-2",children:"Image de l'Ã©vÃ©nement"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"file",onChange:j,accept:"image/*",className:"hidden",id:"imageInput",required:!t}),e.jsxs("label",{htmlFor:"imageInput",className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded text-white cursor-pointer hover:bg-gray-700 flex justify-between items-center",children:[e.jsx("span",{className:"truncate",children:h||"Choisir une image"}),e.jsx("span",{className:"bg-gray-700 px-2 py-1 rounded ml-2",children:"Parcourir"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-white block text-lg font-bold border-b border-gray-600 pb-1 mb-2",children:"Lien de billetterie"}),e.jsx("input",{type:"text",value:r.ticketLink,onChange:l=>n({...r,ticketLink:l.target.value}),placeholder:"Lien billetterie",className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded text-white",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-white block text-lg font-bold border-b border-gray-600 pb-1 mb-2",children:"Genres musicaux"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:r.genres.map(l=>e.jsxs("span",{className:"bg-gray-700 text-white px-3 py-1 rounded-full flex items-center",children:[l,e.jsx("button",{type:"button",onClick:()=>y(l),className:"ml-2 text-red-500 hover:text-red-400",children:"Ã—"})]},l))}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx("input",{type:"text",value:o,onChange:l=>x(l.target.value),placeholder:"Ajouter un genre",className:"flex-1 px-3 py-2 bg-gray-800 border border-gray-700 rounded text-white"}),e.jsx("button",{type:"button",onClick:v,className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Ajouter"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-white block text-lg font-bold border-b border-gray-600 pb-1 mb-2",children:"Options"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:r.isFeatured||!1,onChange:l=>{n({...r,isFeatured:l.target.checked})},className:"mr-2"}),e.jsx("label",{className:"text-white",children:"Mettre en avant (Ã‰vÃ©nement phare)"})]})]})]}),e.jsxs("button",{type:"submit",className:"w-full px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors",children:[t?"Modifier":"CrÃ©er"," l'Ã©vÃ©nement"]})]})},xe=({isOpen:t,event:a,onClose:s,onSubmit:r})=>t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-2 sm:p-4 z-50 overflow-y-auto scrollbar-none",onClick:n=>{n.target===n.currentTarget&&s()},children:e.jsxs("div",{className:"bg-gray-900 rounded-lg p-4 w-full max-w-3xl max-h-[85vh] my-6 sm:my-8 overflow-y-auto scrollbar-thin scrollbar-track-gray-800 scrollbar-thumb-gray-600 hover:scrollbar-thumb-gray-500",onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 pb-4 border-b border-gray-700",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:a?"Modifier un Ã©vÃ©nement":"Nouvel Ã©vÃ©nement"}),e.jsx("button",{onClick:s,className:"text-gray-400 hover:text-white text-xl px-2",children:"âœ•"})]}),e.jsx(he,{event:a||void 0,onSubmit:r})]})}):null,pe=({hasOrderChanged:t,saveOrderLoading:a,isSelectionMode:s,selectedCount:r,onCancelOrder:n,onSaveOrder:m,onDeselectAll:i,onHideSelected:h,onUnhideSelected:b,onDeleteSelected:o,onSelectAll:x,onToggleSelectionMode:v,onCreateNew:y,onRenumber:N})=>e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[t&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:n,className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700",children:"Annuler"}),e.jsx("button",{onClick:m,disabled:a,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 disabled:opacity-50",children:a?"Sauvegarde...":"Sauvegarder l'ordre"})]}),s&&r>0&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:i,className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700",children:"Tout dÃ©sÃ©lectionner"}),e.jsxs("button",{onClick:h,className:"px-4 py-2 bg-orange-600 text-white rounded hover:bg-orange-700",children:["Masquer (",r,")"]}),e.jsxs("button",{onClick:b,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",children:["Afficher (",r,")"]}),e.jsxs("button",{onClick:o,className:"px-4 py-2 bg-red-700 text-white rounded hover:bg-red-800",children:["Supprimer (",r,")"]})]}),s&&r===0&&e.jsx("button",{onClick:x,className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700",children:"Tout sÃ©lectionner"}),e.jsx("button",{onClick:v,className:`px-4 py-2 rounded ${s?"bg-yellow-600 hover:bg-yellow-700":"bg-blue-600 hover:bg-blue-700"} text-white`,children:s?"Annuler sÃ©lection":"SÃ©lectionner"}),e.jsx("button",{onClick:y,className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Nouvel Ã©vÃ©nement"}),e.jsx("button",{onClick:N,className:"px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700 text-sm",title:"RenumÃ©roter tous les Ã©vÃ©nements visibles de 1 Ã  N",children:"RenumÃ©roter"})]}),P={async testConnection(){return(await F.get("/shotgun-sync/test")).data},async syncAllEvents(){return(await F.post("/shotgun-sync/sync-all")).data},async syncEventById(t){return(await F.post(`/shotgun-sync/sync-event/${t}`)).data},async previewEvents(){return(await F.get("/shotgun-sync/preview")).data}},be=()=>{const[t,a]=d.useState(!1),[s,r]=d.useState(null),[n,m]=d.useState(null),i=async()=>{a(!0),r(null),m(null);try{(await P.testConnection()).success?r({type:"success",text:"âœ… Connexion Ã  l'API Shotgun rÃ©ussie !"}):r({type:"error",text:"âŒ Ã‰chec de la connexion Ã  l'API Shotgun"})}catch(o){r({type:"error",text:`âŒ Erreur: ${o instanceof Error?o.message:"Erreur inconnue"}`})}finally{a(!1)}},h=async()=>{if(window.confirm("Voulez-vous vraiment synchroniser tous les Ã©vÃ©nements depuis Shotgun ? Cela peut prendre quelques instants.")){a(!0),r(null),m(null);try{const o=await P.syncAllEvents();o.success&&o.data?(m({created:o.data.created,updated:o.data.updated,errors:o.data.errors}),r({type:"success",text:`âœ… Synchronisation rÃ©ussie ! ${o.data.created} crÃ©Ã©(s), ${o.data.updated} mis Ã  jour`}),setTimeout(()=>{window.location.reload()},2e3)):r({type:"error",text:"âŒ Ã‰chec de la synchronisation"})}catch(o){r({type:"error",text:`âŒ Erreur: ${o instanceof Error?o.message:"Erreur inconnue"}`})}finally{a(!1)}}},b=async()=>{var o;a(!0),r(null),m(null);try{const x=await P.previewEvents();if(x.success&&x.data){const v=((o=x.data.events)==null?void 0:o.length)||0;r({type:"info",text:`â„¹ï¸  ${v} Ã©vÃ©nement(s) trouvÃ©(s) sur Shotgun`})}}catch(x){r({type:"error",text:`âŒ Erreur: ${x instanceof Error?x.message:"Erreur inconnue"}`})}finally{a(!1)}};return e.jsxs("div",{className:"bg-gray-900 p-6 rounded-lg space-y-6",children:[e.jsxs("div",{className:"border-b border-gray-700 pb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"ðŸ”„ Synchronisation Shotgun"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Importez automatiquement vos Ã©vÃ©nements depuis votre compte Shotgun organisateur"})]}),s&&e.jsx("div",{className:`p-4 rounded-lg ${s.type==="success"?"bg-green-900/30 border border-green-700 text-green-300":s.type==="error"?"bg-red-900/30 border border-red-700 text-red-300":"bg-blue-900/30 border border-blue-700 text-blue-300"}`,children:s.text}),n&&e.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-white font-bold mb-2",children:"ðŸ“Š RÃ©sultat :"}),e.jsxs("ul",{className:"text-gray-300 space-y-1",children:[e.jsxs("li",{children:["âœ… ",n.created," Ã©vÃ©nement(s) crÃ©Ã©(s)"]}),e.jsxs("li",{children:["âœï¸  ",n.updated," Ã©vÃ©nement(s) mis Ã  jour"]}),n.errors.length>0&&e.jsxs("li",{className:"text-red-400",children:["âŒ ",n.errors.length," erreur(s)"]})]}),n.errors.length>0&&e.jsxs("details",{className:"mt-4",children:[e.jsx("summary",{className:"text-red-400 cursor-pointer hover:text-red-300",children:"Voir les erreurs"}),e.jsx("ul",{className:"mt-2 space-y-1 text-sm text-red-300",children:n.errors.map((o,x)=>e.jsxs("li",{children:["â€¢ ",o]},x))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsx("button",{onClick:i,disabled:t,className:"px-4 py-3 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:bg-gray-600 disabled:cursor-not-allowed transition-colors font-medium",children:t?"â³ Test...":"ðŸ”Œ Tester la connexion"}),e.jsx("button",{onClick:b,disabled:t,className:"px-4 py-3 bg-yellow-600 text-white rounded hover:bg-yellow-700 disabled:bg-gray-600 disabled:cursor-not-allowed transition-colors font-medium",children:t?"â³ Chargement...":"ðŸ‘ï¸  PrÃ©visualiser"}),e.jsx("button",{onClick:h,disabled:t,className:"px-4 py-3 bg-red-600 text-white rounded hover:bg-red-700 disabled:bg-gray-600 disabled:cursor-not-allowed transition-colors font-medium",children:t?"â³ Sync...":"ðŸ”„ Synchroniser tout"})]}),e.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-white font-bold mb-2",children:"ðŸ“– Instructions :"}),e.jsxs("ol",{className:"text-gray-300 space-y-2 text-sm list-decimal list-inside",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Tester la connexion :"})," VÃ©rifiez que l'API Shotgun est accessible"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"PrÃ©visualiser :"})," VÃ©rifiez combien d'Ã©vÃ©nements seront importÃ©s"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Synchroniser :"})," Importez tous vos Ã©vÃ©nements Shotgun"]})]}),e.jsx("div",{className:"mt-4 p-3 bg-yellow-900/20 border border-yellow-700 rounded",children:e.jsxs("p",{className:"text-yellow-300 text-xs",children:["âš ï¸  ",e.jsx("strong",{children:"Note :"})," Les Ã©vÃ©nements dÃ©jÃ  synchronisÃ©s seront mis Ã  jour, pas dupliquÃ©s. Les images seront automatiquement importÃ©es sur Cloudinary."]})})]})]})},ye={success:"bg-green-600",error:"bg-red-600"},fe=({toast:t,onClose:a})=>e.jsxs("div",{className:"fixed top-4 right-4 z-50 flex items-center gap-3 px-4 py-3 rounded shadow-lg text-white",style:{minWidth:"280px"},role:"alert","aria-live":"assertive",children:[e.jsxs("div",{className:`${ye[t.type]} rounded px-3 py-2 flex-1`,children:[e.jsx("p",{className:"font-semibold",children:t.type==="error"?"Erreur":"SuccÃ¨s"}),e.jsx("p",{className:"text-sm mt-1",children:t.message})]}),e.jsx("button",{onClick:a,className:"text-white hover:text-gray-200","aria-label":"Fermer la notification",children:"âœ•"})]}),Ne=()=>{const{events:t,setEvents:a,loading:s,refetch:r,deleteEvent:n,deleteMany:m,updateOrder:i,hideMany:h,unhideMany:b,hideOne:o,renumberAll:x}=ue(),[v,y]=d.useState(!1),[N,u]=d.useState(null),{draggedId:j,dragOverIndex:l,hasOrderChanged:g,setHasOrderChanged:E,handleDragStart:D,handleDragOver:A,handleDragLeave:p,handleDrop:k,resetOrderChanged:L}=ie(t,a,c=>c._id),[$,I]=d.useState(!1),{selectedIds:S,toggleSelection:R,selectAll:H,deselectAll:M,setSelectedIds:T}=ce(),[z,O]=d.useState(!1),{toast:_,showError:C,showSuccess:q,clearToast:V}=ge(),G=()=>{u(null),y(!0)},B=c=>{u(c),y(!0)},W=async c=>{if(!c){C("ID d'Ã©vÃ©nement invalide");return}if(window.confirm("ÃŠtes-vous sÃ»r de vouloir supprimer cet Ã©vÃ©nement ?"))try{await n(c),E(!1)}catch{C("Erreur lors de la suppression")}},U=async()=>{y(!1),await r(),E(!1)},J=(c,f)=>{D(c,f)},K=(c,f)=>{A(c,f)},Q=()=>{p()},X=async(c,f)=>{k(c,f)},Y=async()=>{if(g)try{I(!0);const c=t.map(f=>f._id);await i(c),E(!1),q("Nouvel ordre enregistrÃ©")}catch(c){C("Erreur lors de la sauvegarde de l'ordre"),console.error("Save order error:",c)}finally{I(!1)}},Z=async()=>{L(),await r()},ee=()=>{O(!z),T(new Set)},te=async()=>{if(S.size!==0&&window.confirm(`ÃŠtes-vous sÃ»r de vouloir supprimer ${S.size} Ã©vÃ©nement(s) ?`))try{await m(Array.from(S)),T(new Set),O(!1),L(),q("Ã‰vÃ©nements supprimÃ©s")}catch{C("Erreur lors de la suppression des Ã©vÃ©nements")}},re=async()=>{if(S.size!==0)try{await h(Array.from(S)),T(new Set),O(!1),q("Ã‰vÃ©nements masquÃ©s")}catch{C("Erreur lors du masquage des Ã©vÃ©nements")}},se=async()=>{if(S.size!==0)try{await b(Array.from(S)),T(new Set),O(!1),q("Ã‰vÃ©nements affichÃ©s")}catch{C("Erreur lors du dÃ©masquage des Ã©vÃ©nements")}},ae=async(c,f)=>{if(c)try{await o(c,f)}catch{C("Erreur lors du masquage/dÃ©masquage de l'Ã©vÃ©nement")}},ne=async()=>{if(window.confirm("RenumÃ©roter tous les Ã©vÃ©nements visibles de 1 Ã  N ?"))try{await x(),alert("RenumÃ©rotation effectuÃ©e avec succÃ¨s !")}catch{C("Erreur lors de la renumÃ©rotation")}};return s?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"text-white",children:"Chargement..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Gestion des Ã©vÃ©nements"}),e.jsx(pe,{hasOrderChanged:g,saveOrderLoading:$,isSelectionMode:z,selectedCount:S.size,onCancelOrder:Z,onSaveOrder:Y,onDeselectAll:M,onHideSelected:re,onUnhideSelected:se,onDeleteSelected:te,onSelectAll:()=>H(t.map(c=>c._id)),onToggleSelectionMode:ee,onCreateNew:G,onRenumber:ne})]}),_&&e.jsx(fe,{toast:_,onClose:V}),e.jsx(be,{}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map((c,f)=>e.jsx(me,{event:c,index:f,isSelectionMode:z,isSelected:S.has(c._id),draggedEventId:j,dragOverIndex:l,onToggleSelect:R,onDragStart:J,onDragOver:K,onDragLeave:Q,onDrop:X,onEdit:B,onToggleHide:ae,onDelete:W},c._id))}),t.length===0&&!s&&e.jsx("div",{className:"text-center py-12 text-gray-400",children:"Aucun Ã©vÃ©nement trouvÃ©"}),e.jsx(xe,{isOpen:v,event:N,onClose:()=>y(!1),onSubmit:U})]})};export{Ne as default};
