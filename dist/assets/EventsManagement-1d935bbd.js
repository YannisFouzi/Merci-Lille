import{j as e}from"./react-query-050d5483.js";import{r as o,R as oe}from"./vendor-cabde3c1.js";import{e as N,s as ie,f as de,p as ce,c as ue,d as z}from"./index-c71602de.js";import{u as me,a as xe}from"./useSelection-f8152783.js";import{a as ge,e as he,v as V}from"./eventForm-bfb5b68b.js";import{u as be}from"./forms-1ddf1958.js";import"./animations-b8bbc998.js";const pe=()=>{const[s,l]=o.useState([]),[a,r]=o.useState(!1),[c,i]=o.useState(""),t=o.useCallback(async()=>{try{r(!0);const u=await N.getAllEvents(!0);l(ie(u)),i("")}catch{i("Erreur lors du chargement des Ã©vÃ©nements")}finally{r(!1)}},[]);o.useEffect(()=>{t()},[t]);const x=o.useCallback(async u=>{await N.deleteEvent(u),await t()},[t]),y=o.useCallback(async u=>{await Promise.all(u.map(w=>N.deleteEvent(w))),await t()},[t]),n=o.useCallback(async u=>{await N.updateEventOrder(u),await t()},[t]),g=o.useCallback(async u=>{await N.hideMultipleEvents(u),await t()},[t]),j=o.useCallback(async u=>{await N.unhideMultipleEvents(u),await t()},[t]),f=o.useCallback(async(u,w)=>{w?await N.unhideEvent(u):await N.hideEvent(u),await t()},[t]),E=o.useCallback(async()=>{await N.renumberAllEvents(),await t()},[t]);return{events:s,setEvents:l,loading:a,error:c,setError:i,refetch:t,deleteEvent:x,deleteMany:y,updateOrder:n,hideMany:g,unhideMany:j,hideOne:f,renumberAll:E}},ye=(s=4e3)=>{const[l,a]=o.useState(null),r=o.useCallback(()=>a(null),[]),c=o.useCallback((x,y)=>{a({type:x,message:y})},[]),i=o.useCallback(x=>c("error",x),[c]),t=o.useCallback(x=>c("success",x),[c]);return o.useEffect(()=>{if(!l)return;const x=setTimeout(()=>a(null),s);return()=>clearTimeout(x)},[l,s]),{toast:l,showError:i,showSuccess:t,clearToast:r}},fe=({event:s,index:l,isSelectionMode:a,isSelected:r,draggedEventId:c,dragOverIndex:i,onToggleSelect:t,onDragStart:x,onDragOver:y,onDragLeave:n,onDrop:g,onEdit:j,onToggleHide:f,onDelete:E})=>{var k,O;const u=new Date,w=new Date(s.date),[A,I]=s.time.split(":");w.setHours(parseInt(A,10),parseInt(I,10));const S=w<=u;return e.jsxs("div",{draggable:!a,onDragStart:h=>!a&&x(h,s._id),onDragOver:h=>!a&&y(h,l),onDragLeave:a?void 0:n,onDrop:h=>!a&&g(h,l),onClick:()=>a&&t(s._id),className:`relative bg-gray-800 rounded-lg overflow-hidden transition-all duration-200 ${a?"cursor-pointer":"cursor-move"} ${c===s._id?"opacity-50 scale-95":""} ${i===l?"ring-2 ring-blue-400 scale-105":""} ${a&&r?"ring-4 ring-red-500":""} ${s.isHidden?"opacity-50":""}`,children:[e.jsxs("div",{className:"absolute top-2 left-2 bg-black bg-opacity-75 text-white text-sm font-bold px-3 py-1 rounded z-10",children:["#",(k=s.eventNumber)!=null&&k.startsWith("HIDDEN_")||(O=s.eventNumber)!=null&&O.startsWith("TEMP_")?"---":s.eventNumber||"---"]}),a&&e.jsx("div",{className:"absolute top-2 left-16 z-10",children:e.jsx("input",{type:"checkbox",checked:r,onChange:h=>{h.stopPropagation(),t(s._id)},className:"w-6 h-6 cursor-pointer"})}),e.jsxs("div",{className:"absolute top-2 right-2 z-10 flex gap-2",children:[s.isHidden&&e.jsx("span",{className:"bg-orange-600 text-white text-xs px-2 py-1 rounded font-bold",children:"MasquÃ©"}),s.isFeatured&&e.jsx("span",{className:"bg-yellow-500 text-black text-xs px-2 py-1 rounded font-bold",children:"Phare"}),S?e.jsx("span",{className:"bg-gray-600 text-gray-300 text-xs px-2 py-1 rounded",children:"PassÃ©"}):e.jsx("span",{className:"bg-green-600 text-white text-xs px-2 py-1 rounded",children:"Ã€ venir"})]}),e.jsx("div",{className:"h-48 overflow-hidden",children:e.jsx("img",{src:s.imageSrc,alt:s.title,className:"w-full h-full object-cover pointer-events-none"})}),e.jsxs("div",{className:"p-4 space-y-2",children:[e.jsx("h3",{className:"text-white font-bold text-lg truncate",children:s.title}),e.jsxs("div",{className:"text-gray-400 text-sm space-y-1",children:[e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx("span",{role:"img","aria-label":"date",children:"ðŸ“…"}),e.jsx("span",{children:de(s.date)})]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx("span",{role:"img","aria-label":"location",children:"ðŸ“"}),e.jsx("span",{children:s.city})]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx("span",{role:"img","aria-label":"genres",children:"ðŸŽµ"}),e.jsx("span",{className:"truncate",children:s.genres&&s.genres.length>0?s.genres.join(", "):"Aucun genre"})]})]}),!a&&e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{onClick:h=>{h.stopPropagation(),j(s)},className:"flex-1 px-3 py-2 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 transition-colors",children:"Modifier"}),e.jsx("button",{onClick:h=>{h.stopPropagation(),f(s._id,s.isHidden||!1)},className:`flex-1 px-3 py-2 text-white text-sm rounded transition-colors ${s.isHidden?"bg-green-600 hover:bg-green-700":"bg-orange-600 hover:bg-orange-700"}`,children:s.isHidden?"Afficher":"Masquer"}),e.jsx("button",{onClick:h=>{h.stopPropagation(),E(s._id)},className:"flex-1 px-3 py-2 bg-red-600 text-white text-sm rounded hover:bg-red-700 transition-colors",children:"Supprimer"})]})]})]},s._id)},ve=({event:s,onSubmit:l})=>{const a=b=>new Date(b).toISOString().split("T")[0],{register:r,handleSubmit:c,formState:{errors:i,isSubmitting:t},watch:x,setValue:y}=be({resolver:ge(he),mode:"onBlur",defaultValues:s?{...s,date:a(s.date),genres:ce(s.genres),isFeatured:s.isFeatured||!1}:{title:"",city:"",date:"",time:"",genres:[],ticketLink:"",isFeatured:!1}}),[n,g]=o.useState(null),[j,f]=o.useState(""),[E,u]=o.useState(""),[w,A]=o.useState(""),[I,S]=o.useState(""),k=x("genres");oe.useEffect(()=>{s!=null&&s.imageSrc&&f(ue(s.imageSrc))},[s]);const O=b=>{var m;const p=(m=b.target.files)==null?void 0:m[0];if(p){const C=V(p,!!s);C.valid?(g(p),f(p.name),S(""),A("")):(S(C.error||"Erreur de validation de l'image"),g(null),f(""))}},h=b=>{b.preventDefault();const p=E.trim();p&&!k.includes(p)&&(y("genres",[...k,p],{shouldDirty:!0}),u(""))},q=b=>{y("genres",k.filter(p=>p!==b),{shouldDirty:!0})},L=async b=>{A(""),S("");const p=V(n,!!s);if(!p.valid){S(p.error||"Erreur de validation de l'image");return}try{const m=new FormData;Object.entries(b).forEach(([C,F])=>{F!=null&&(C==="genres"?(Array.isArray(F)?F:[]).forEach((T,$)=>{m.append(`genres[${$}]`,T)}):m.append(C,F.toString()))}),n&&m.append("image",n),s!=null&&s._id?await N.updateEvent(s._id,m):await N.createEvent(m),l()}catch(m){const C=m instanceof Error?m.message:"Une erreur est survenue lors de l'enregistrement";A(C)}};return e.jsxs("form",{onSubmit:c(L),className:"space-y-6 bg-gray-900 p-4 rounded-lg sm:p-6",children:[w&&e.jsx("div",{className:"bg-red-500/10 border border-red-500 text-red-500 px-4 py-3 rounded",children:w}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-white block text-lg font-bold border-b border-gray-600 pb-1 mb-2",children:"Titre de l'Ã©vÃ©nement"}),e.jsx("input",{type:"text",placeholder:"Titre de l'Ã©vÃ©nement",className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded text-white",disabled:t,...r("title")}),i.title&&e.jsx("div",{className:"text-red-500 text-sm mt-1",children:i.title.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-white block text-lg font-bold border-b border-gray-600 pb-1 mb-2",children:"Ville"}),e.jsx("input",{type:"text",placeholder:"Ville",className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded text-white",disabled:t,...r("city")}),i.city&&e.jsx("div",{className:"text-red-500 text-sm mt-1",children:i.city.message})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-white block text-lg font-bold border-b border-gray-600 pb-1 mb-2",children:"Date"}),e.jsx("input",{type:"date",className:"px-3 py-2 bg-gray-800 border border-gray-700 rounded text-white w-full",disabled:t,...r("date")}),i.date&&e.jsx("div",{className:"text-red-500 text-sm mt-1",children:i.date.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-white block text-lg font-bold border-b border-gray-600 pb-1 mb-2",children:"Heure"}),e.jsx("input",{type:"time",className:"px-3 py-2 bg-gray-800 border border-gray-700 rounded text-white w-full",disabled:t,...r("time")}),i.time&&e.jsx("div",{className:"text-red-500 text-sm mt-1",children:i.time.message})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-white block text-lg font-bold border-b border-gray-600 pb-1 mb-2",children:"Image de l'Ã©vÃ©nement"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"file",onChange:O,accept:"image/*",className:"hidden",id:"imageInput",disabled:t}),e.jsxs("label",{htmlFor:"imageInput",className:`w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded text-white ${t?"opacity-50 cursor-not-allowed":"cursor-pointer hover:bg-gray-700"} flex justify-between items-center`,children:[e.jsx("span",{className:"truncate",children:j||"Choisir une image"}),e.jsx("span",{className:"bg-gray-700 px-2 py-1 rounded ml-2",children:"Parcourir"})]})]}),I&&e.jsx("div",{className:"text-red-500 text-sm mt-1",children:I})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-white block text-lg font-bold border-b border-gray-600 pb-1 mb-2",children:"Lien de billetterie"}),e.jsx("input",{type:"text",placeholder:"Lien billetterie",className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded text-white",disabled:t,...r("ticketLink")}),i.ticketLink&&e.jsx("div",{className:"text-red-500 text-sm mt-1",children:i.ticketLink.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-white block text-lg font-bold border-b border-gray-600 pb-1 mb-2",children:"Genres musicaux"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:k.map(b=>e.jsxs("span",{className:"bg-gray-700 text-white px-3 py-1 rounded-full flex items-center",children:[b,e.jsx("button",{type:"button",onClick:()=>q(b),className:"ml-2 text-red-500 hover:text-red-400",disabled:t,children:"Ã—"})]},b))}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx("input",{type:"text",value:E,onChange:b=>u(b.target.value),placeholder:"Ajouter un genre",className:"flex-1 px-3 py-2 bg-gray-800 border border-gray-700 rounded text-white",disabled:t}),e.jsx("button",{type:"button",onClick:h,className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed",disabled:t,children:"Ajouter"})]}),i.genres&&e.jsx("div",{className:"text-red-500 text-sm mt-1",children:i.genres.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-white block text-lg font-bold border-b border-gray-600 pb-1 mb-2",children:"Options"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",className:"mr-2",disabled:t,...r("isFeatured")}),e.jsx("label",{className:"text-white",children:"Mettre en avant (Ã‰vÃ©nement phare)"})]})]})]}),e.jsxs("button",{type:"submit",className:"w-full px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:t,children:[t?"Enregistrement...":s?"Modifier":"CrÃ©er"," ","l'Ã©vÃ©nement"]})]})},je=({isOpen:s,event:l,onClose:a,onSubmit:r})=>s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-2 sm:p-4 z-50 overflow-y-auto scrollbar-none",onClick:c=>{c.target===c.currentTarget&&a()},children:e.jsxs("div",{className:"bg-gray-900 rounded-lg p-4 w-full max-w-3xl max-h-[85vh] my-6 sm:my-8 overflow-y-auto scrollbar-thin scrollbar-track-gray-800 scrollbar-thumb-gray-600 hover:scrollbar-thumb-gray-500",onClick:c=>c.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 pb-4 border-b border-gray-700",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:l?"Modifier un Ã©vÃ©nement":"Nouvel Ã©vÃ©nement"}),e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-white text-xl px-2",children:"âœ•"})]}),e.jsx(ve,{event:l||void 0,onSubmit:r})]})}):null,we=({hasOrderChanged:s,saveOrderLoading:l,isSelectionMode:a,selectedCount:r,onCancelOrder:c,onSaveOrder:i,onDeselectAll:t,onHideSelected:x,onUnhideSelected:y,onDeleteSelected:n,onSelectAll:g,onToggleSelectionMode:j,onCreateNew:f,onRenumber:E})=>e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[s&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:c,className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700",children:"Annuler"}),e.jsx("button",{onClick:i,disabled:l,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 disabled:opacity-50",children:l?"Sauvegarde...":"Sauvegarder l'ordre"})]}),a&&r>0&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:t,className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700",children:"Tout dÃ©sÃ©lectionner"}),e.jsxs("button",{onClick:x,className:"px-4 py-2 bg-orange-600 text-white rounded hover:bg-orange-700",children:["Masquer (",r,")"]}),e.jsxs("button",{onClick:y,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",children:["Afficher (",r,")"]}),e.jsxs("button",{onClick:n,className:"px-4 py-2 bg-red-700 text-white rounded hover:bg-red-800",children:["Supprimer (",r,")"]})]}),a&&r===0&&e.jsx("button",{onClick:g,className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700",children:"Tout sÃ©lectionner"}),e.jsx("button",{onClick:j,className:`px-4 py-2 rounded ${a?"bg-yellow-600 hover:bg-yellow-700":"bg-blue-600 hover:bg-blue-700"} text-white`,children:a?"Annuler sÃ©lection":"SÃ©lectionner"}),e.jsx("button",{onClick:f,className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Nouvel Ã©vÃ©nement"}),e.jsx("button",{onClick:E,className:"px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700 text-sm",title:"RenumÃ©roter tous les Ã©vÃ©nements visibles de 1 Ã  N",children:"RenumÃ©roter"})]}),R={async testConnection(){return(await z.get("/shotgun-sync/test")).data},async syncAllEvents(){return(await z.post("/shotgun-sync/sync-all")).data},async syncEventById(s){return(await z.post(`/shotgun-sync/sync-event/${s}`)).data},async previewEvents(){return(await z.get("/shotgun-sync/preview")).data}},Ne=()=>{const[s,l]=o.useState(!1),[a,r]=o.useState(null),[c,i]=o.useState(null),t=async()=>{l(!0),r(null),i(null);try{(await R.testConnection()).success?r({type:"success",text:"âœ… Connexion Ã  l'API Shotgun rÃ©ussie !"}):r({type:"error",text:"âŒ Ã‰chec de la connexion Ã  l'API Shotgun"})}catch(n){r({type:"error",text:`âŒ Erreur: ${n instanceof Error?n.message:"Erreur inconnue"}`})}finally{l(!1)}},x=async()=>{if(window.confirm("Voulez-vous vraiment synchroniser tous les Ã©vÃ©nements depuis Shotgun ? Cela peut prendre quelques instants.")){l(!0),r(null),i(null);try{const n=await R.syncAllEvents();n.success&&n.data?(i({created:n.data.created,updated:n.data.updated,errors:n.data.errors}),r({type:"success",text:`âœ… Synchronisation rÃ©ussie ! ${n.data.created} crÃ©Ã©(s), ${n.data.updated} mis Ã  jour`}),setTimeout(()=>{window.location.reload()},2e3)):r({type:"error",text:"âŒ Ã‰chec de la synchronisation"})}catch(n){r({type:"error",text:`âŒ Erreur: ${n instanceof Error?n.message:"Erreur inconnue"}`})}finally{l(!1)}}},y=async()=>{var n;l(!0),r(null),i(null);try{const g=await R.previewEvents();if(g.success&&g.data){const j=((n=g.data.events)==null?void 0:n.length)||0;r({type:"info",text:`â„¹ï¸  ${j} Ã©vÃ©nement(s) trouvÃ©(s) sur Shotgun`})}}catch(g){r({type:"error",text:`âŒ Erreur: ${g instanceof Error?g.message:"Erreur inconnue"}`})}finally{l(!1)}};return e.jsxs("div",{className:"bg-gray-900 p-6 rounded-lg space-y-6",children:[e.jsxs("div",{className:"border-b border-gray-700 pb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"ðŸ”„ Synchronisation Shotgun"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Importez automatiquement vos Ã©vÃ©nements depuis votre compte Shotgun organisateur"})]}),a&&e.jsx("div",{className:`p-4 rounded-lg ${a.type==="success"?"bg-green-900/30 border border-green-700 text-green-300":a.type==="error"?"bg-red-900/30 border border-red-700 text-red-300":"bg-blue-900/30 border border-blue-700 text-blue-300"}`,children:a.text}),c&&e.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-white font-bold mb-2",children:"ðŸ“Š RÃ©sultat :"}),e.jsxs("ul",{className:"text-gray-300 space-y-1",children:[e.jsxs("li",{children:["âœ… ",c.created," Ã©vÃ©nement(s) crÃ©Ã©(s)"]}),e.jsxs("li",{children:["âœï¸  ",c.updated," Ã©vÃ©nement(s) mis Ã  jour"]}),c.errors.length>0&&e.jsxs("li",{className:"text-red-400",children:["âŒ ",c.errors.length," erreur(s)"]})]}),c.errors.length>0&&e.jsxs("details",{className:"mt-4",children:[e.jsx("summary",{className:"text-red-400 cursor-pointer hover:text-red-300",children:"Voir les erreurs"}),e.jsx("ul",{className:"mt-2 space-y-1 text-sm text-red-300",children:c.errors.map((n,g)=>e.jsxs("li",{children:["â€¢ ",n]},g))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsx("button",{onClick:t,disabled:s,className:"px-4 py-3 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:bg-gray-600 disabled:cursor-not-allowed transition-colors font-medium",children:s?"â³ Test...":"ðŸ”Œ Tester la connexion"}),e.jsx("button",{onClick:y,disabled:s,className:"px-4 py-3 bg-yellow-600 text-white rounded hover:bg-yellow-700 disabled:bg-gray-600 disabled:cursor-not-allowed transition-colors font-medium",children:s?"â³ Chargement...":"ðŸ‘ï¸  PrÃ©visualiser"}),e.jsx("button",{onClick:x,disabled:s,className:"px-4 py-3 bg-red-600 text-white rounded hover:bg-red-700 disabled:bg-gray-600 disabled:cursor-not-allowed transition-colors font-medium",children:s?"â³ Sync...":"ðŸ”„ Synchroniser tout"})]}),e.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-white font-bold mb-2",children:"ðŸ“– Instructions :"}),e.jsxs("ol",{className:"text-gray-300 space-y-2 text-sm list-decimal list-inside",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Tester la connexion :"})," VÃ©rifiez que l'API Shotgun est accessible"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"PrÃ©visualiser :"})," VÃ©rifiez combien d'Ã©vÃ©nements seront importÃ©s"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Synchroniser :"})," Importez tous vos Ã©vÃ©nements Shotgun"]})]}),e.jsx("div",{className:"mt-4 p-3 bg-yellow-900/20 border border-yellow-700 rounded",children:e.jsxs("p",{className:"text-yellow-300 text-xs",children:["âš ï¸  ",e.jsx("strong",{children:"Note :"})," Les Ã©vÃ©nements dÃ©jÃ  synchronisÃ©s seront mis Ã  jour, pas dupliquÃ©s. Les images seront automatiquement importÃ©es sur Cloudinary."]})})]})]})},Ee={success:"bg-green-600",error:"bg-red-600"},Se=({toast:s,onClose:l})=>e.jsxs("div",{className:"fixed top-4 right-4 z-50 flex items-center gap-3 px-4 py-3 rounded shadow-lg text-white",style:{minWidth:"280px"},role:"alert","aria-live":"assertive",children:[e.jsxs("div",{className:`${Ee[s.type]} rounded px-3 py-2 flex-1`,children:[e.jsx("p",{className:"font-semibold",children:s.type==="error"?"Erreur":"SuccÃ¨s"}),e.jsx("p",{className:"text-sm mt-1",children:s.message})]}),e.jsx("button",{onClick:l,className:"text-white hover:text-gray-200","aria-label":"Fermer la notification",children:"âœ•"})]}),$e=()=>{const{events:s,setEvents:l,loading:a,refetch:r,deleteEvent:c,deleteMany:i,updateOrder:t,hideMany:x,unhideMany:y,hideOne:n,renumberAll:g}=pe(),[j,f]=o.useState(!1),[E,u]=o.useState(null),{draggedId:w,dragOverIndex:A,hasOrderChanged:I,setHasOrderChanged:S,handleDragStart:k,handleDragOver:O,handleDragLeave:h,handleDrop:q,resetOrderChanged:L}=me(s,l,d=>d._id),[b,p]=o.useState(!1),{selectedIds:m,toggleSelection:C,selectAll:F,deselectAll:H,setSelectedIds:T}=xe(),[$,P]=o.useState(!1),{toast:M,showError:D,showSuccess:_,clearToast:G}=ye(),U=()=>{u(null),f(!0)},W=d=>{u(d),f(!0)},B=async d=>{if(!d){D("ID d'Ã©vÃ©nement invalide");return}if(window.confirm("ÃŠtes-vous sÃ»r de vouloir supprimer cet Ã©vÃ©nement ?"))try{await c(d),S(!1)}catch{D("Erreur lors de la suppression")}},J=async()=>{f(!1),await r(),S(!1)},K=(d,v)=>{k(d,v)},Q=(d,v)=>{O(d,v)},X=()=>{h()},Y=async(d,v)=>{q(d,v)},Z=async()=>{if(I)try{p(!0);const d=s.map(v=>v._id);await t(d),S(!1),_("Nouvel ordre enregistrÃ©")}catch(d){D("Erreur lors de la sauvegarde de l'ordre"),console.error("Save order error:",d)}finally{p(!1)}},ee=async()=>{L(),await r()},se=()=>{P(!$),T(new Set)},te=async()=>{if(m.size!==0&&window.confirm(`ÃŠtes-vous sÃ»r de vouloir supprimer ${m.size} Ã©vÃ©nement(s) ?`))try{await i(Array.from(m)),T(new Set),P(!1),L(),_("Ã‰vÃ©nements supprimÃ©s")}catch{D("Erreur lors de la suppression des Ã©vÃ©nements")}},re=async()=>{if(m.size!==0)try{await x(Array.from(m)),T(new Set),P(!1),_("Ã‰vÃ©nements masquÃ©s")}catch{D("Erreur lors du masquage des Ã©vÃ©nements")}},ae=async()=>{if(m.size!==0)try{await y(Array.from(m)),T(new Set),P(!1),_("Ã‰vÃ©nements affichÃ©s")}catch{D("Erreur lors du dÃ©masquage des Ã©vÃ©nements")}},ne=async(d,v)=>{if(d)try{await n(d,v)}catch{D("Erreur lors du masquage/dÃ©masquage de l'Ã©vÃ©nement")}},le=async()=>{if(window.confirm("RenumÃ©roter tous les Ã©vÃ©nements visibles de 1 Ã  N ?"))try{await g(),alert("RenumÃ©rotation effectuÃ©e avec succÃ¨s !")}catch{D("Erreur lors de la renumÃ©rotation")}};return a?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"text-white",children:"Chargement..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Gestion des Ã©vÃ©nements"}),e.jsx(we,{hasOrderChanged:I,saveOrderLoading:b,isSelectionMode:$,selectedCount:m.size,onCancelOrder:ee,onSaveOrder:Z,onDeselectAll:H,onHideSelected:re,onUnhideSelected:ae,onDeleteSelected:te,onSelectAll:()=>F(s.map(d=>d._id)),onToggleSelectionMode:se,onCreateNew:U,onRenumber:le})]}),M&&e.jsx(Se,{toast:M,onClose:G}),e.jsx(Ne,{}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:s.map((d,v)=>e.jsx(fe,{event:d,index:v,isSelectionMode:$,isSelected:m.has(d._id),draggedEventId:w,dragOverIndex:A,onToggleSelect:C,onDragStart:K,onDragOver:Q,onDragLeave:X,onDrop:Y,onEdit:W,onToggleHide:ne,onDelete:B},d._id))}),s.length===0&&!a&&e.jsx("div",{className:"text-center py-12 text-gray-400",children:"Aucun Ã©vÃ©nement trouvÃ©"}),e.jsx(je,{isOpen:j,event:E,onClose:()=>f(!1),onSubmit:J})]})};export{$e as default};
