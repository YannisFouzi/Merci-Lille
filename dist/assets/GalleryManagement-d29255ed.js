import{j as e}from"./react-query-050d5483.js";import{r as d}from"./vendor-cabde3c1.js";import{g as b}from"./index-c71602de.js";import{a as Y,u as Z}from"./useSelection-f8152783.js";import"./animations-b8bbc998.js";const ee=()=>{const[s,t]=d.useState([]),[o,u]=d.useState(!1),[l,m]=d.useState(""),r=d.useCallback(async()=>{try{u(!0);const n=await b.getAllImages();t(n),m("")}catch{m("Erreur lors du chargement des images")}finally{u(!1)}},[]);d.useEffect(()=>{r()},[r]);const h=d.useCallback(async n=>{await b.uploadImages(n),await r()},[r]),f=d.useCallback(async n=>{await b.deleteImages(n),await r()},[r]),x=d.useCallback(async n=>{await b.deleteImage(n),await r()},[r]),c=d.useCallback(async n=>{await b.updateImageOrder(n),await r()},[r]);return{images:s,setImages:t,loading:o,error:l,setError:m,refetch:r,uploadImages:h,deleteMany:f,deleteOne:x,updateOrder:c}},ae=({image:s,index:t,isSelected:o,draggedImageId:u,dragOverIndex:l,onToggleSelect:m,onDragStart:r,onDragOver:h,onDragLeave:f,onDrop:x})=>e.jsxs("div",{draggable:!0,onDragStart:c=>r(c,s._id),onDragOver:c=>h(c,t),onDragLeave:f,onDrop:c=>x(c,t),className:`relative group bg-gray-800 rounded-lg overflow-hidden cursor-move transition-all duration-200 ${o?"ring-2 ring-red-500":""} ${u===s._id?"opacity-50 scale-95":""} ${l===t?"ring-2 ring-blue-400 scale-105":""}`,onClick:()=>m(s._id),children:[e.jsx("img",{src:s.imageSrc,alt:"Gallery",className:"w-full h-48 object-cover pointer-events-none"}),e.jsx("div",{className:"absolute top-2 right-2 bg-black bg-opacity-75 text-white text-xs px-2 py-1 rounded",children:t+1}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 transition-all duration-300 flex items-center justify-center",children:e.jsx("button",{onClick:c=>{c.stopPropagation(),m(s._id)},className:"opacity-0 group-hover:opacity-100 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-opacity duration-300 pointer-events-auto",children:o?"Désélectionner":"Sélectionner"})})]},s._id),re=({hasOrderChanged:s,saveOrderLoading:t,uploadLoading:o,isDragOver:u,onCancelOrder:l,onSaveOrder:m,onOpenUpload:r,onDragOver:h,onDragLeave:f,onDrop:x})=>e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Gestion de la galerie"}),e.jsxs("div",{className:"flex gap-2",children:[s&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:l,className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700",children:"Annuler"}),e.jsx("button",{onClick:m,disabled:t,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 disabled:opacity-50",children:t?"Sauvegarde...":"Sauvegarder l'ordre"})]}),e.jsxs("button",{onClick:r,onDragOver:h,onDragLeave:f,onDrop:x,disabled:o,className:`px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-all duration-200 flex items-center gap-2 disabled:opacity-50 ${u?"bg-red-500 scale-105 shadow-lg":""}`,children:[o&&e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),o?"Upload en cours...":u?"Déposez vos images ici":"Ajouter une image"]})]})]}),se=({isOpen:s,selectedFiles:t,uploadLoading:o,onClose:u,onFileChange:l,onSubmit:m})=>s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-gray-900 rounded-lg p-6 w-full max-w-md",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Ajouter des images"}),e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("input",{type:"file",onChange:l,accept:"image/*",multiple:!0,className:"text-white w-full"}),t&&e.jsxs("p",{className:"text-gray-400 mt-2",children:[t.length," fichier(s) sélectionné(s)"]})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:u,className:"px-4 py-2 text-gray-400 hover:text-white",children:"Annuler"}),e.jsxs("button",{type:"submit",disabled:o||!t,className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 disabled:opacity-50 flex items-center gap-2",children:[o&&e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),o?"Upload en cours...":"Upload"]})]})]})]})}):null,de=()=>{const{images:s,setImages:t,loading:o,error:u,setError:l,refetch:m,uploadImages:r,deleteMany:h,updateOrder:f}=ee(),[x,c]=d.useState(!1),[n,w]=d.useState(null),[D,y]=d.useState(!1),{selectedIds:v,toggleSelection:_,setSelectedIds:C}=Y(),[L,N]=d.useState(!1),[j,S]=d.useState(!1),{draggedId:k,dragOverIndex:$,hasOrderChanged:z,setHasOrderChanged:U,handleDragStart:T,handleDragOver:M,handleDragLeave:V,handleDrop:q,resetOrderChanged:O}=Z(s,t,a=>a._id),[W,G]=d.useState(!1),H=a=>{a.target.files&&a.target.files.length>0&&w(a.target.files)},P=async a=>{if(a.preventDefault(),!n||n.length===0){l("Veuillez sélectionner au moins une image");return}try{y(!0);const i=new FormData;for(let p=0;p<n.length;p++)i.append("images",n[p]);await r(i),c(!1),w(null),O()}catch(i){l("Erreur lors de l'upload des images"),console.error("Upload error:",i)}finally{y(!1)}},R=async()=>{if(v.size!==0&&window.confirm(`Êtes-vous sûr de vouloir supprimer ${v.size} image(s) ?`))try{await h(Array.from(v)),C(new Set)}catch{l("Erreur lors de la suppression des images")}},B=a=>{a.preventDefault(),N(!0)},J=a=>{a.preventDefault(),N(!1)},K=async a=>{a.preventDefault(),N(!1);const i=a.dataTransfer.files;if(i&&i.length>0){const p=Array.from(i).filter(g=>g.type.startsWith("image/"));if(p.length>0)try{y(!0);const g=new FormData;p.forEach(I=>{g.append("images",I)}),await r(g),U(!1)}catch(g){l("Erreur lors de l'upload des images"),console.error("Upload error:",g)}finally{y(!1)}else l("Veuillez déposer uniquement des fichiers image")}},A=a=>{a.preventDefault(),a.dataTransfer.types.includes("Files")&&S(!0)},E=a=>{a.preventDefault(),a.currentTarget.contains(a.relatedTarget)||S(!1)},F=async a=>{if(a.preventDefault(),S(!1),k)return;const i=a.dataTransfer.files;if(i&&i.length>0){const p=Array.from(i).filter(g=>g.type.startsWith("image/"));if(p.length>0)try{y(!0);const g=new FormData;p.forEach(I=>{g.append("images",I)}),await r(g),U(!1)}catch(g){l("Erreur lors de l'upload des images"),console.error("Upload error:",g)}finally{y(!1)}else l("Veuillez déposer uniquement des fichiers image")}},Q=async()=>{if(z)try{G(!0);const a=s.map(i=>i._id);await f(a),O()}catch(a){l("Erreur lors de la sauvegarde de l'ordre"),console.error("Save order error:",a)}finally{G(!1)}},X=async()=>{O(),await m()};return o?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"text-white",children:"Chargement..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(re,{hasOrderChanged:z,saveOrderLoading:W,uploadLoading:D,isDragOver:L,onCancelOrder:X,onSaveOrder:Q,onOpenUpload:()=>c(!0),onDragOver:B,onDragLeave:J,onDrop:K}),u&&e.jsx("div",{className:"bg-red-500 text-white p-4 rounded",children:u}),D&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-900 rounded-lg p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-white text-lg font-medium mb-2",children:"Upload en cours..."}),e.jsx("p",{className:"text-gray-400",children:"Veuillez patienter pendant l'ajout des images"})]})}),e.jsx(se,{isOpen:x,selectedFiles:n,uploadLoading:D,onClose:()=>{c(!1),w(null)},onFileChange:H,onSubmit:P}),v.size>0&&e.jsx("div",{className:"fixed bottom-4 left-4 right-4 sm:left-auto sm:right-4 sm:w-auto bg-gray-900 p-4 rounded-lg shadow-lg z-50",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-3",children:[e.jsxs("p",{className:"text-white text-center sm:text-left",children:[v.size," image(s) sélectionnée(s)"]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto",children:[e.jsx("button",{onClick:()=>C(new Set),className:"w-full sm:w-auto px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700",children:"Annuler"}),e.jsx("button",{onClick:R,className:"w-full sm:w-auto px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Supprimer la sélection"})]})]})}),e.jsxs("div",{className:`grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6 transition-all duration-200 ${j?"bg-gray-800/50 ring-2 ring-red-400 ring-dashed p-6 rounded-lg":""}`,onDragOver:A,onDragLeave:E,onDrop:F,children:[j&&e.jsx("div",{className:"col-span-full flex items-center justify-center py-12 text-center",children:e.jsx("div",{className:"text-red-400 text-xl font-medium",children:"Déposez vos images ici pour les ajouter à la galerie"})}),s.map((a,i)=>e.jsx(ae,{image:a,index:i,isSelected:v.has(a._id),draggedImageId:k,dragOverIndex:$,onToggleSelect:_,onDragStart:T,onDragOver:M,onDragLeave:V,onDrop:q},a._id))]}),s.length===0&&!o&&e.jsx("div",{className:`text-center py-12 transition-all duration-200 ${j?"bg-gray-800/50 ring-2 ring-red-400 ring-dashed p-6 rounded-lg":""}`,onDragOver:A,onDragLeave:E,onDrop:F,children:j?e.jsx("div",{className:"text-red-400 text-xl font-medium",children:"Déposez vos images ici pour créer votre galerie"}):e.jsxs("div",{className:"text-gray-400",children:["Aucune image dans la galerie",e.jsx("br",{}),e.jsx("span",{className:"text-sm",children:'Glissez-déposez des images ici ou utilisez le bouton "Ajouter une image"'})]})})]})};export{de as default};
