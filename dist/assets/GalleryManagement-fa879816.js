import{r as l,j as a,h as m}from"./index-db185757.js";const Z=()=>{const[f,S]=l.useState([]),[I,O]=l.useState(!0),[C,n]=l.useState(""),[_,v]=l.useState(!1),[i,y]=l.useState(null),[o,c]=l.useState(!1),[d,b]=l.useState([]),[z,j]=l.useState(!1),[h,w]=l.useState(!1),[x,D]=l.useState(null),[T,N]=l.useState(null),[E,g]=l.useState(!1),[k,F]=l.useState(!1),u=async()=>{try{O(!0);const e=await m.getAllImages();S(e),n("")}catch{n("Erreur lors du chargement des images")}finally{O(!1)}};l.useEffect(()=>{u()},[]);const $=e=>{e.target.files&&e.target.files.length>0&&y(e.target.files)},V=async e=>{if(e.preventDefault(),!i||i.length===0){n("Veuillez sélectionner au moins une image");return}try{c(!0);const t=new FormData;for(let s=0;s<i.length;s++)t.append("images",i[s]);await m.uploadImages(t),await u(),v(!1),y(null),g(!1)}catch(t){n("Erreur lors de l'upload des images"),console.error("Upload error:",t)}finally{c(!1)}},L=e=>{b(t=>t.includes(e)?t.filter(s=>s!==e):[...t,e])},q=async()=>{if(d.length!==0&&window.confirm(`Êtes-vous sûr de vouloir supprimer ${d.length} image(s) ?`))try{await m.deleteImages(d),await u(),b([])}catch{n("Erreur lors de la suppression des images")}},W=e=>{e.preventDefault(),j(!0)},H=e=>{e.preventDefault(),j(!1)},M=async e=>{e.preventDefault(),j(!1);const t=e.dataTransfer.files;if(t&&t.length>0){const s=Array.from(t).filter(r=>r.type.startsWith("image/"));if(s.length>0)try{c(!0);const r=new FormData;s.forEach(p=>{r.append("images",p)}),await m.uploadImages(r),await u(),g(!1)}catch(r){n("Erreur lors de l'upload des images"),console.error("Upload error:",r)}finally{c(!1)}else n("Veuillez déposer uniquement des fichiers image")}},A=e=>{e.preventDefault(),e.dataTransfer.types.includes("Files")&&w(!0)},U=e=>{e.preventDefault(),e.currentTarget.contains(e.relatedTarget)||w(!1)},G=async e=>{if(e.preventDefault(),w(!1),x)return;const t=e.dataTransfer.files;if(t&&t.length>0){const s=Array.from(t).filter(r=>r.type.startsWith("image/"));if(s.length>0)try{c(!0);const r=new FormData;s.forEach(p=>{r.append("images",p)}),await m.uploadImages(r),await u(),g(!1)}catch(r){n("Erreur lors de l'upload des images"),console.error("Upload error:",r)}finally{c(!1)}else n("Veuillez déposer uniquement des fichiers image")}},P=(e,t)=>{D(t),e.dataTransfer.effectAllowed="move"},R=(e,t)=>{e.preventDefault(),e.dataTransfer.dropEffect="move",N(t)},B=()=>{N(null)},J=async(e,t)=>{if(e.preventDefault(),N(null),!x)return;const s=f.findIndex(X=>X._id===x);if(s===-1||s===t){D(null);return}const r=[...f],[p]=r.splice(s,1);r.splice(t,0,p),S(r),D(null),g(!0)},K=async()=>{if(E)try{F(!0);const e=f.map(t=>t._id);await m.updateImageOrder(e),g(!1)}catch(e){n("Erreur lors de la sauvegarde de l'ordre"),console.error("Save order error:",e)}finally{F(!1)}},Q=async()=>{g(!1),await u()};return I?a.jsx("div",{className:"flex justify-center items-center h-64",children:a.jsx("div",{className:"text-white",children:"Chargement..."})}):a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[a.jsx("h1",{className:"text-2xl font-bold text-white",children:"Gestion de la galerie"}),a.jsxs("div",{className:"flex gap-2",children:[E&&a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:Q,className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700",children:"Annuler"}),a.jsx("button",{onClick:K,disabled:k,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 disabled:opacity-50",children:k?"Sauvegarde...":"Sauvegarder l'ordre"})]}),a.jsxs("button",{onClick:()=>v(!0),onDragOver:W,onDragLeave:H,onDrop:M,disabled:o,className:`px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-all duration-200 flex items-center gap-2 disabled:opacity-50 ${z?"bg-red-500 scale-105 shadow-lg":""}`,children:[o&&a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),o?"Upload en cours...":z?"Déposez vos images ici":"Ajouter une image"]})]})]}),C&&a.jsx("div",{className:"bg-red-500 text-white p-4 rounded",children:C}),o&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:a.jsxs("div",{className:"bg-gray-900 rounded-lg p-8 text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-red-500 mx-auto mb-4"}),a.jsx("h3",{className:"text-white text-lg font-medium mb-2",children:"Upload en cours..."}),a.jsx("p",{className:"text-gray-400",children:"Veuillez patienter pendant l'ajout des images"})]})}),_&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50",children:a.jsxs("div",{className:"bg-gray-900 rounded-lg p-6 w-full max-w-md",children:[a.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Ajouter des images"}),a.jsxs("form",{onSubmit:V,className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("input",{type:"file",onChange:$,accept:"image/*",multiple:!0,className:"text-white w-full"}),i&&a.jsxs("p",{className:"text-gray-400 mt-2",children:[i.length," fichier(s) sélectionné(s)"]})]}),a.jsxs("div",{className:"flex justify-end gap-4",children:[a.jsx("button",{type:"button",onClick:()=>{v(!1),y(null)},className:"px-4 py-2 text-gray-400 hover:text-white",children:"Annuler"}),a.jsxs("button",{type:"submit",disabled:o||!i,className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 disabled:opacity-50 flex items-center gap-2",children:[o&&a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),o?"Upload en cours...":"Upload"]})]})]})]})}),d.length>0&&a.jsx("div",{className:"fixed bottom-4 left-4 right-4 sm:left-auto sm:right-4 sm:w-auto bg-gray-900 p-4 rounded-lg shadow-lg z-50",children:a.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-3",children:[a.jsxs("p",{className:"text-white text-center sm:text-left",children:[d.length," image(s) sélectionnée(s)"]}),a.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto",children:[a.jsx("button",{onClick:()=>b([]),className:"w-full sm:w-auto px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700",children:"Annuler"}),a.jsx("button",{onClick:q,className:"w-full sm:w-auto px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Supprimer la sélection"})]})]})}),a.jsxs("div",{className:`grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6 transition-all duration-200 ${h?"bg-gray-800/50 ring-2 ring-red-400 ring-dashed p-6 rounded-lg":""}`,onDragOver:A,onDragLeave:U,onDrop:G,children:[h&&a.jsx("div",{className:"col-span-full flex items-center justify-center py-12 text-center",children:a.jsx("div",{className:"text-red-400 text-xl font-medium",children:"Déposez vos images ici pour les ajouter à la galerie"})}),f.map((e,t)=>a.jsxs("div",{draggable:!0,onDragStart:s=>P(s,e._id),onDragOver:s=>R(s,t),onDragLeave:B,onDrop:s=>J(s,t),className:`relative group bg-gray-800 rounded-lg overflow-hidden cursor-move transition-all duration-200 ${d.includes(e._id)?"ring-2 ring-red-500":""} ${x===e._id?"opacity-50 scale-95":""} ${T===t?"ring-2 ring-blue-400 scale-105":""}`,onClick:()=>L(e._id),children:[a.jsx("img",{src:e.imageSrc,alt:"Gallery",className:"w-full h-48 object-cover pointer-events-none"}),a.jsx("div",{className:"absolute top-2 right-2 bg-black bg-opacity-75 text-white text-xs px-2 py-1 rounded",children:t+1}),a.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 transition-all duration-300 flex items-center justify-center",children:a.jsx("button",{onClick:s=>{s.stopPropagation(),L(e._id)},className:"opacity-0 group-hover:opacity-100 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-opacity duration-300 pointer-events-auto",children:d.includes(e._id)?"Désélectionner":"Sélectionner"})})]},e._id))]}),f.length===0&&!I&&a.jsx("div",{className:`text-center py-12 transition-all duration-200 ${h?"bg-gray-800/50 ring-2 ring-red-400 ring-dashed p-6 rounded-lg":""}`,onDragOver:A,onDragLeave:U,onDrop:G,children:h?a.jsx("div",{className:"text-red-400 text-xl font-medium",children:"Déposez vos images ici pour créer votre galerie"}):a.jsxs("div",{className:"text-gray-400",children:["Aucune image dans la galerie",a.jsx("br",{}),a.jsx("span",{className:"text-sm",children:'Glissez-déposez des images ici ou utilisez le bouton "Ajouter une image"'})]})})]})};export{Z as default};
