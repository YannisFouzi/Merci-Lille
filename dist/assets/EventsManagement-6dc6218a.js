import{r as o,e as N,s as ie,j as e,f as de,p as ce,R as ue,g as me,h as _}from"./index-1bfa666a.js";import{u as ge,a as he}from"./useSelection-5613b69c.js";import{i as F,V as H,b as xe}from"./validation-e4cf7e42.js";const be=()=>{const[s,i]=o.useState([]),[r,t]=o.useState(!1),[c,g]=o.useState(""),d=o.useCallback(async()=>{try{t(!0);const m=await N.getAllEvents(!0);i(ie(m)),g("")}catch{g("Erreur lors du chargement des Ã©vÃ©nements")}finally{t(!1)}},[]);o.useEffect(()=>{d()},[d]);const x=o.useCallback(async m=>{await N.deleteEvent(m),await d()},[d]),f=o.useCallback(async m=>{await Promise.all(m.map(E=>N.deleteEvent(E))),await d()},[d]),n=o.useCallback(async m=>{await N.updateEventOrder(m),await d()},[d]),b=o.useCallback(async m=>{await N.hideMultipleEvents(m),await d()},[d]),v=o.useCallback(async m=>{await N.unhideMultipleEvents(m),await d()},[d]),p=o.useCallback(async(m,E)=>{E?await N.unhideEvent(m):await N.hideEvent(m),await d()},[d]),h=o.useCallback(async()=>{await N.renumberAllEvents(),await d()},[d]);return{events:s,setEvents:i,loading:r,error:c,setError:g,refetch:d,deleteEvent:x,deleteMany:f,updateOrder:n,hideMany:b,unhideMany:v,hideOne:p,renumberAll:h}},pe=(s=4e3)=>{const[i,r]=o.useState(null),t=o.useCallback(()=>r(null),[]),c=o.useCallback((x,f)=>{r({type:x,message:f})},[]),g=o.useCallback(x=>c("error",x),[c]),d=o.useCallback(x=>c("success",x),[c]);return o.useEffect(()=>{if(!i)return;const x=setTimeout(()=>r(null),s);return()=>clearTimeout(x)},[i,s]),{toast:i,showError:g,showSuccess:d,clearToast:t}},ye=({event:s,index:i,isSelectionMode:r,isSelected:t,draggedEventId:c,dragOverIndex:g,onToggleSelect:d,onDragStart:x,onDragOver:f,onDragLeave:n,onDrop:b,onEdit:v,onToggleHide:p,onDelete:h})=>{var j,a;const m=new Date,E=new Date(s.date),[A,D]=s.time.split(":");E.setHours(parseInt(A,10),parseInt(D,10));const C=E<=m;return e.jsxs("div",{draggable:!r,onDragStart:l=>!r&&x(l,s._id),onDragOver:l=>!r&&f(l,i),onDragLeave:r?void 0:n,onDrop:l=>!r&&b(l,i),onClick:()=>r&&d(s._id),className:`relative bg-gray-800 rounded-lg overflow-hidden transition-all duration-200 ${r?"cursor-pointer":"cursor-move"} ${c===s._id?"opacity-50 scale-95":""} ${g===i?"ring-2 ring-blue-400 scale-105":""} ${r&&t?"ring-4 ring-red-500":""} ${s.isHidden?"opacity-50":""}`,children:[e.jsxs("div",{className:"absolute top-2 left-2 bg-black bg-opacity-75 text-white text-sm font-bold px-3 py-1 rounded z-10",children:["#",(j=s.eventNumber)!=null&&j.startsWith("HIDDEN_")||(a=s.eventNumber)!=null&&a.startsWith("TEMP_")?"---":s.eventNumber||"---"]}),r&&e.jsx("div",{className:"absolute top-2 left-16 z-10",children:e.jsx("input",{type:"checkbox",checked:t,onChange:l=>{l.stopPropagation(),d(s._id)},className:"w-6 h-6 cursor-pointer"})}),e.jsxs("div",{className:"absolute top-2 right-2 z-10 flex gap-2",children:[s.isHidden&&e.jsx("span",{className:"bg-orange-600 text-white text-xs px-2 py-1 rounded font-bold",children:"MasquÃ©"}),s.isFeatured&&e.jsx("span",{className:"bg-yellow-500 text-black text-xs px-2 py-1 rounded font-bold",children:"Phare"}),C?e.jsx("span",{className:"bg-gray-600 text-gray-300 text-xs px-2 py-1 rounded",children:"PassÃ©"}):e.jsx("span",{className:"bg-green-600 text-white text-xs px-2 py-1 rounded",children:"Ã€ venir"})]}),e.jsx("div",{className:"h-48 overflow-hidden",children:e.jsx("img",{src:s.imageSrc,alt:s.title,className:"w-full h-full object-cover pointer-events-none"})}),e.jsxs("div",{className:"p-4 space-y-2",children:[e.jsx("h3",{className:"text-white font-bold text-lg truncate",children:s.title}),e.jsxs("div",{className:"text-gray-400 text-sm space-y-1",children:[e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx("span",{role:"img","aria-label":"date",children:"ðŸ“…"}),e.jsx("span",{children:de(s.date)})]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx("span",{role:"img","aria-label":"location",children:"ðŸ“"}),e.jsx("span",{children:s.city})]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx("span",{role:"img","aria-label":"genres",children:"ðŸŽµ"}),e.jsx("span",{className:"truncate",children:s.genres&&s.genres.length>0?s.genres.join(", "):"Aucun genre"})]})]}),!r&&e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{onClick:l=>{l.stopPropagation(),v(s)},className:"flex-1 px-3 py-2 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 transition-colors",children:"Modifier"}),e.jsx("button",{onClick:l=>{l.stopPropagation(),p(s._id,s.isHidden||!1)},className:`flex-1 px-3 py-2 text-white text-sm rounded transition-colors ${s.isHidden?"bg-green-600 hover:bg-green-700":"bg-orange-600 hover:bg-orange-700"}`,children:s.isHidden?"Afficher":"Masquer"}),e.jsx("button",{onClick:l=>{l.stopPropagation(),h(s._id)},className:"flex-1 px-3 py-2 bg-red-600 text-white text-sm rounded hover:bg-red-700 transition-colors",children:"Supprimer"})]})]})]},s._id)},fe=({event:s,onSubmit:i})=>{const r=a=>new Date(a).toISOString().split("T")[0],[t,c]=o.useState(s?{...s,date:r(s.date),genres:ce(s.genres)}:{title:"",eventNumber:"",city:"",date:"",time:"",genres:[],ticketLink:"",imageSrc:"",isFeatured:!1}),[g,d]=o.useState(null),[x,f]=o.useState(""),[n,b]=o.useState(""),[v,p]=o.useState(""),[h,m]=o.useState(!1),E=a=>{a.preventDefault(),n.trim()&&!t.genres.includes(n.trim())&&(c({...t,genres:[...t.genres,n.trim()]}),b(""))},A=a=>{c({...t,genres:t.genres.filter(l=>l!==a)})},D=async a=>{a.preventDefault(),p(""),m(!0);try{const l=new FormData,{eventNumber:k,...O}=t,R={...O};if(!F(t.title)||!F(t.city)||!F(t.date)||!F(t.time)||!F(t.ticketLink))throw new Error(H.REQUIRED);if(!g&&!(s!=null&&s.imageSrc))throw new Error(H.FILE_REQUIRED);if(Object.entries(R).forEach(([I,y])=>{y!=null&&(I==="genres"?(Array.isArray(y)?y:[]).forEach(($,P)=>{l.append(`genres[${P}]`,$)}):l.append(I,y.toString()))}),g){if(!xe(g,5))throw new Error(H.FILE_TOO_LARGE(5));l.append("image",g)}s!=null&&s._id?await N.updateEvent(s._id,l):await N.createEvent(l),i()}catch(l){const k=l instanceof Error?l.message:"Une erreur est survenue lors de l'enregistrement";p(k)}finally{m(!1)}};ue.useEffect(()=>{s!=null&&s.imageSrc&&f(me(s.imageSrc))},[s]);const C=a=>{var k;const l=(k=a.target.files)==null?void 0:k[0];l&&(d(l),f(l.name),v&&p(""))},j=a=>{c({...t,...a}),v&&p("")};return e.jsxs("form",{onSubmit:D,className:"space-y-6 bg-gray-900 p-4 rounded-lg sm:p-6",children:[v&&e.jsx("div",{className:"bg-red-500/10 border border-red-500 text-red-500 px-4 py-3 rounded",children:v}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-white block text-lg font-bold border-b border-gray-600 pb-1 mb-2",children:"Titre de l'Ã©vÃ©nement"}),e.jsx("input",{type:"text",value:t.title,onChange:a=>j({title:a.target.value}),placeholder:"Titre de l'Ã©vÃ©nement",className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded text-white",required:!0,disabled:h})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-white block text-lg font-bold border-b border-gray-600 pb-1 mb-2",children:"Ville"}),e.jsx("input",{type:"text",value:t.city,onChange:a=>j({city:a.target.value}),placeholder:"Ville",className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded text-white",required:!0,disabled:h})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-white block text-lg font-bold border-b border-gray-600 pb-1 mb-2",children:"Date"}),e.jsx("input",{type:"date",value:t.date,onChange:a=>j({date:a.target.value}),className:"px-3 py-2 bg-gray-800 border border-gray-700 rounded text-white w-full",required:!0,disabled:h})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-white block text-lg font-bold border-b border-gray-600 pb-1 mb-2",children:"Heure"}),e.jsx("input",{type:"time",value:t.time,onChange:a=>j({time:a.target.value}),className:"px-3 py-2 bg-gray-800 border border-gray-700 rounded text-white w-full",required:!0,disabled:h})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-white block text-lg font-bold border-b border-gray-600 pb-1 mb-2",children:"Image de l'Ã©vÃ©nement"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"file",onChange:C,accept:"image/*",className:"hidden",id:"imageInput",required:!s,disabled:h}),e.jsxs("label",{htmlFor:"imageInput",className:`w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded text-white ${h?"opacity-50 cursor-not-allowed":"cursor-pointer hover:bg-gray-700"} flex justify-between items-center`,children:[e.jsx("span",{className:"truncate",children:x||"Choisir une image"}),e.jsx("span",{className:"bg-gray-700 px-2 py-1 rounded ml-2",children:"Parcourir"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-white block text-lg font-bold border-b border-gray-600 pb-1 mb-2",children:"Lien de billetterie"}),e.jsx("input",{type:"text",value:t.ticketLink,onChange:a=>j({ticketLink:a.target.value}),placeholder:"Lien billetterie",className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded text-white",required:!0,disabled:h})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-white block text-lg font-bold border-b border-gray-600 pb-1 mb-2",children:"Genres musicaux"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:t.genres.map(a=>e.jsxs("span",{className:"bg-gray-700 text-white px-3 py-1 rounded-full flex items-center",children:[a,e.jsx("button",{type:"button",onClick:()=>A(a),className:"ml-2 text-red-500 hover:text-red-400",disabled:h,children:"Ã—"})]},a))}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx("input",{type:"text",value:n,onChange:a=>b(a.target.value),placeholder:"Ajouter un genre",className:"flex-1 px-3 py-2 bg-gray-800 border border-gray-700 rounded text-white",disabled:h}),e.jsx("button",{type:"button",onClick:E,className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed",disabled:h,children:"Ajouter"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-white block text-lg font-bold border-b border-gray-600 pb-1 mb-2",children:"Options"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:t.isFeatured||!1,onChange:a=>j({isFeatured:a.target.checked}),className:"mr-2",disabled:h}),e.jsx("label",{className:"text-white",children:"Mettre en avant (Ã‰vÃ©nement phare)"})]})]})]}),e.jsxs("button",{type:"submit",className:"w-full px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:h,children:[h?"Enregistrement...":s?"Modifier":"CrÃ©er"," l'Ã©vÃ©nement"]})]})},ve=({isOpen:s,event:i,onClose:r,onSubmit:t})=>s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-2 sm:p-4 z-50 overflow-y-auto scrollbar-none",onClick:c=>{c.target===c.currentTarget&&r()},children:e.jsxs("div",{className:"bg-gray-900 rounded-lg p-4 w-full max-w-3xl max-h-[85vh] my-6 sm:my-8 overflow-y-auto scrollbar-thin scrollbar-track-gray-800 scrollbar-thumb-gray-600 hover:scrollbar-thumb-gray-500",onClick:c=>c.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 pb-4 border-b border-gray-700",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:i?"Modifier un Ã©vÃ©nement":"Nouvel Ã©vÃ©nement"}),e.jsx("button",{onClick:r,className:"text-gray-400 hover:text-white text-xl px-2",children:"âœ•"})]}),e.jsx(fe,{event:i||void 0,onSubmit:t})]})}):null,we=({hasOrderChanged:s,saveOrderLoading:i,isSelectionMode:r,selectedCount:t,onCancelOrder:c,onSaveOrder:g,onDeselectAll:d,onHideSelected:x,onUnhideSelected:f,onDeleteSelected:n,onSelectAll:b,onToggleSelectionMode:v,onCreateNew:p,onRenumber:h})=>e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[s&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:c,className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700",children:"Annuler"}),e.jsx("button",{onClick:g,disabled:i,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 disabled:opacity-50",children:i?"Sauvegarde...":"Sauvegarder l'ordre"})]}),r&&t>0&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:d,className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700",children:"Tout dÃ©sÃ©lectionner"}),e.jsxs("button",{onClick:x,className:"px-4 py-2 bg-orange-600 text-white rounded hover:bg-orange-700",children:["Masquer (",t,")"]}),e.jsxs("button",{onClick:f,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",children:["Afficher (",t,")"]}),e.jsxs("button",{onClick:n,className:"px-4 py-2 bg-red-700 text-white rounded hover:bg-red-800",children:["Supprimer (",t,")"]})]}),r&&t===0&&e.jsx("button",{onClick:b,className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700",children:"Tout sÃ©lectionner"}),e.jsx("button",{onClick:v,className:`px-4 py-2 rounded ${r?"bg-yellow-600 hover:bg-yellow-700":"bg-blue-600 hover:bg-blue-700"} text-white`,children:r?"Annuler sÃ©lection":"SÃ©lectionner"}),e.jsx("button",{onClick:p,className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Nouvel Ã©vÃ©nement"}),e.jsx("button",{onClick:h,className:"px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700 text-sm",title:"RenumÃ©roter tous les Ã©vÃ©nements visibles de 1 Ã  N",children:"RenumÃ©roter"})]}),M={async testConnection(){return(await _.get("/shotgun-sync/test")).data},async syncAllEvents(){return(await _.post("/shotgun-sync/sync-all")).data},async syncEventById(s){return(await _.post(`/shotgun-sync/sync-event/${s}`)).data},async previewEvents(){return(await _.get("/shotgun-sync/preview")).data}},je=()=>{const[s,i]=o.useState(!1),[r,t]=o.useState(null),[c,g]=o.useState(null),d=async()=>{i(!0),t(null),g(null);try{(await M.testConnection()).success?t({type:"success",text:"âœ… Connexion Ã  l'API Shotgun rÃ©ussie !"}):t({type:"error",text:"âŒ Ã‰chec de la connexion Ã  l'API Shotgun"})}catch(n){t({type:"error",text:`âŒ Erreur: ${n instanceof Error?n.message:"Erreur inconnue"}`})}finally{i(!1)}},x=async()=>{if(window.confirm("Voulez-vous vraiment synchroniser tous les Ã©vÃ©nements depuis Shotgun ? Cela peut prendre quelques instants.")){i(!0),t(null),g(null);try{const n=await M.syncAllEvents();n.success&&n.data?(g({created:n.data.created,updated:n.data.updated,errors:n.data.errors}),t({type:"success",text:`âœ… Synchronisation rÃ©ussie ! ${n.data.created} crÃ©Ã©(s), ${n.data.updated} mis Ã  jour`}),setTimeout(()=>{window.location.reload()},2e3)):t({type:"error",text:"âŒ Ã‰chec de la synchronisation"})}catch(n){t({type:"error",text:`âŒ Erreur: ${n instanceof Error?n.message:"Erreur inconnue"}`})}finally{i(!1)}}},f=async()=>{var n;i(!0),t(null),g(null);try{const b=await M.previewEvents();if(b.success&&b.data){const v=((n=b.data.events)==null?void 0:n.length)||0;t({type:"info",text:`â„¹ï¸  ${v} Ã©vÃ©nement(s) trouvÃ©(s) sur Shotgun`})}}catch(b){t({type:"error",text:`âŒ Erreur: ${b instanceof Error?b.message:"Erreur inconnue"}`})}finally{i(!1)}};return e.jsxs("div",{className:"bg-gray-900 p-6 rounded-lg space-y-6",children:[e.jsxs("div",{className:"border-b border-gray-700 pb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"ðŸ”„ Synchronisation Shotgun"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Importez automatiquement vos Ã©vÃ©nements depuis votre compte Shotgun organisateur"})]}),r&&e.jsx("div",{className:`p-4 rounded-lg ${r.type==="success"?"bg-green-900/30 border border-green-700 text-green-300":r.type==="error"?"bg-red-900/30 border border-red-700 text-red-300":"bg-blue-900/30 border border-blue-700 text-blue-300"}`,children:r.text}),c&&e.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-white font-bold mb-2",children:"ðŸ“Š RÃ©sultat :"}),e.jsxs("ul",{className:"text-gray-300 space-y-1",children:[e.jsxs("li",{children:["âœ… ",c.created," Ã©vÃ©nement(s) crÃ©Ã©(s)"]}),e.jsxs("li",{children:["âœï¸  ",c.updated," Ã©vÃ©nement(s) mis Ã  jour"]}),c.errors.length>0&&e.jsxs("li",{className:"text-red-400",children:["âŒ ",c.errors.length," erreur(s)"]})]}),c.errors.length>0&&e.jsxs("details",{className:"mt-4",children:[e.jsx("summary",{className:"text-red-400 cursor-pointer hover:text-red-300",children:"Voir les erreurs"}),e.jsx("ul",{className:"mt-2 space-y-1 text-sm text-red-300",children:c.errors.map((n,b)=>e.jsxs("li",{children:["â€¢ ",n]},b))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsx("button",{onClick:d,disabled:s,className:"px-4 py-3 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:bg-gray-600 disabled:cursor-not-allowed transition-colors font-medium",children:s?"â³ Test...":"ðŸ”Œ Tester la connexion"}),e.jsx("button",{onClick:f,disabled:s,className:"px-4 py-3 bg-yellow-600 text-white rounded hover:bg-yellow-700 disabled:bg-gray-600 disabled:cursor-not-allowed transition-colors font-medium",children:s?"â³ Chargement...":"ðŸ‘ï¸  PrÃ©visualiser"}),e.jsx("button",{onClick:x,disabled:s,className:"px-4 py-3 bg-red-600 text-white rounded hover:bg-red-700 disabled:bg-gray-600 disabled:cursor-not-allowed transition-colors font-medium",children:s?"â³ Sync...":"ðŸ”„ Synchroniser tout"})]}),e.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-white font-bold mb-2",children:"ðŸ“– Instructions :"}),e.jsxs("ol",{className:"text-gray-300 space-y-2 text-sm list-decimal list-inside",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Tester la connexion :"})," VÃ©rifiez que l'API Shotgun est accessible"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"PrÃ©visualiser :"})," VÃ©rifiez combien d'Ã©vÃ©nements seront importÃ©s"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Synchroniser :"})," Importez tous vos Ã©vÃ©nements Shotgun"]})]}),e.jsx("div",{className:"mt-4 p-3 bg-yellow-900/20 border border-yellow-700 rounded",children:e.jsxs("p",{className:"text-yellow-300 text-xs",children:["âš ï¸  ",e.jsx("strong",{children:"Note :"})," Les Ã©vÃ©nements dÃ©jÃ  synchronisÃ©s seront mis Ã  jour, pas dupliquÃ©s. Les images seront automatiquement importÃ©es sur Cloudinary."]})})]})]})},Ne={success:"bg-green-600",error:"bg-red-600"},Ee=({toast:s,onClose:i})=>e.jsxs("div",{className:"fixed top-4 right-4 z-50 flex items-center gap-3 px-4 py-3 rounded shadow-lg text-white",style:{minWidth:"280px"},role:"alert","aria-live":"assertive",children:[e.jsxs("div",{className:`${Ne[s.type]} rounded px-3 py-2 flex-1`,children:[e.jsx("p",{className:"font-semibold",children:s.type==="error"?"Erreur":"SuccÃ¨s"}),e.jsx("p",{className:"text-sm mt-1",children:s.message})]}),e.jsx("button",{onClick:i,className:"text-white hover:text-gray-200","aria-label":"Fermer la notification",children:"âœ•"})]}),Ae=()=>{const{events:s,setEvents:i,loading:r,refetch:t,deleteEvent:c,deleteMany:g,updateOrder:d,hideMany:x,unhideMany:f,hideOne:n,renumberAll:b}=be(),[v,p]=o.useState(!1),[h,m]=o.useState(null),{draggedId:E,dragOverIndex:A,hasOrderChanged:D,setHasOrderChanged:C,handleDragStart:j,handleDragOver:a,handleDragLeave:l,handleDrop:k,resetOrderChanged:O}=ge(s,i,u=>u._id),[R,I]=o.useState(!1),{selectedIds:y,toggleSelection:G,selectAll:$,deselectAll:P,setSelectedIds:T}=he(),[z,q]=o.useState(!1),{toast:V,showError:S,showSuccess:L,clearToast:U}=pe(),W=()=>{m(null),p(!0)},Q=u=>{m(u),p(!0)},B=async u=>{if(!u){S("ID d'Ã©vÃ©nement invalide");return}if(window.confirm("ÃŠtes-vous sÃ»r de vouloir supprimer cet Ã©vÃ©nement ?"))try{await c(u),C(!1)}catch{S("Erreur lors de la suppression")}},J=async()=>{p(!1),await t(),C(!1)},K=(u,w)=>{j(u,w)},X=(u,w)=>{a(u,w)},Y=()=>{l()},Z=async(u,w)=>{k(u,w)},ee=async()=>{if(D)try{I(!0);const u=s.map(w=>w._id);await d(u),C(!1),L("Nouvel ordre enregistrÃ©")}catch(u){S("Erreur lors de la sauvegarde de l'ordre"),console.error("Save order error:",u)}finally{I(!1)}},se=async()=>{O(),await t()},te=()=>{q(!z),T(new Set)},re=async()=>{if(y.size!==0&&window.confirm(`ÃŠtes-vous sÃ»r de vouloir supprimer ${y.size} Ã©vÃ©nement(s) ?`))try{await g(Array.from(y)),T(new Set),q(!1),O(),L("Ã‰vÃ©nements supprimÃ©s")}catch{S("Erreur lors de la suppression des Ã©vÃ©nements")}},ae=async()=>{if(y.size!==0)try{await x(Array.from(y)),T(new Set),q(!1),L("Ã‰vÃ©nements masquÃ©s")}catch{S("Erreur lors du masquage des Ã©vÃ©nements")}},ne=async()=>{if(y.size!==0)try{await f(Array.from(y)),T(new Set),q(!1),L("Ã‰vÃ©nements affichÃ©s")}catch{S("Erreur lors du dÃ©masquage des Ã©vÃ©nements")}},le=async(u,w)=>{if(u)try{await n(u,w)}catch{S("Erreur lors du masquage/dÃ©masquage de l'Ã©vÃ©nement")}},oe=async()=>{if(window.confirm("RenumÃ©roter tous les Ã©vÃ©nements visibles de 1 Ã  N ?"))try{await b(),alert("RenumÃ©rotation effectuÃ©e avec succÃ¨s !")}catch{S("Erreur lors de la renumÃ©rotation")}};return r?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"text-white",children:"Chargement..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Gestion des Ã©vÃ©nements"}),e.jsx(we,{hasOrderChanged:D,saveOrderLoading:R,isSelectionMode:z,selectedCount:y.size,onCancelOrder:se,onSaveOrder:ee,onDeselectAll:P,onHideSelected:ae,onUnhideSelected:ne,onDeleteSelected:re,onSelectAll:()=>$(s.map(u=>u._id)),onToggleSelectionMode:te,onCreateNew:W,onRenumber:oe})]}),V&&e.jsx(Ee,{toast:V,onClose:U}),e.jsx(je,{}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:s.map((u,w)=>e.jsx(ye,{event:u,index:w,isSelectionMode:z,isSelected:y.has(u._id),draggedEventId:E,dragOverIndex:A,onToggleSelect:G,onDragStart:K,onDragOver:X,onDragLeave:Y,onDrop:Z,onEdit:Q,onToggleHide:le,onDelete:B},u._id))}),s.length===0&&!r&&e.jsx("div",{className:"text-center py-12 text-gray-400",children:"Aucun Ã©vÃ©nement trouvÃ©"}),e.jsx(ve,{isOpen:v,event:h,onClose:()=>p(!1),onSubmit:J})]})};export{Ae as default};
